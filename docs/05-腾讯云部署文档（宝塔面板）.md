# å³è´¸ Amazon è¯„è®ºæ™ºèƒ½åˆ†æ - è…¾è®¯äº‘éƒ¨ç½²æ–‡æ¡£ï¼ˆå®å¡”é¢æ¿ï¼‰

**ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-21  
**æ“ä½œç³»ç»Ÿ**: CentOS 7.x / Ubuntu 20.04 LTS  
**é¢æ¿ç‰ˆæœ¬**: å®å¡”Linuxé¢æ¿ 8.0+

---

## ğŸ“‹ ç›®å½•

1. [æœåŠ¡å™¨é‡‡è´­ä¸é…ç½®](#1-æœåŠ¡å™¨é‡‡è´­ä¸é…ç½®)
2. [å®å¡”é¢æ¿å®‰è£…](#2-å®å¡”é¢æ¿å®‰è£…)
3. [ç¯å¢ƒé…ç½®](#3-ç¯å¢ƒé…ç½®)
4. [æ•°æ®åº“é…ç½®](#4-æ•°æ®åº“é…ç½®)
5. [åº”ç”¨éƒ¨ç½²](#5-åº”ç”¨éƒ¨ç½²)
6. [åŸŸåä¸HTTPSé…ç½®](#6-åŸŸåä¸httpsé…ç½®)
7. [ç›‘æ§ä¸è¿ç»´](#7-ç›‘æ§ä¸è¿ç»´)

---

## 1. æœåŠ¡å™¨é‡‡è´­ä¸é…ç½®

### 1.1 æ¨èé…ç½®

#### ğŸ”¹ **å¼€å‘/æµ‹è¯•ç¯å¢ƒ**

**è…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨**:
```
CPU: 2æ ¸
å†…å­˜: 4GB
ç¡¬ç›˜: 80GB SSD
å¸¦å®½: 5Mbps
æ“ä½œç³»ç»Ÿ: CentOS 7.9 æˆ– Ubuntu 20.04
ä»·æ ¼: Â¥74/æœˆ (å¹´ä»˜ä¼˜æƒ )
```

**è´­ä¹°é“¾æ¥**: https://cloud.tencent.com/product/lighthouse

#### ğŸ”¹ **ç”Ÿäº§ç¯å¢ƒï¼ˆ100-1000ç”¨æˆ·ï¼‰**

**è…¾è®¯äº‘CVMæ ‡å‡†å‹S5**:
```
CPU: 4æ ¸
å†…å­˜: 8GB
ç¡¬ç›˜: 100GB SSDäº‘ç¡¬ç›˜
å¸¦å®½: 10Mbps
æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS
ä»·æ ¼: Â¥268/æœˆ (å¹´ä»˜ä¼˜æƒ )
```

**è´­ä¹°é“¾æ¥**: https://cloud.tencent.com/product/cvm

#### ğŸ”¹ **ç”Ÿäº§ç¯å¢ƒï¼ˆ1000+ç”¨æˆ·ï¼‰**

**è…¾è®¯äº‘CVMæ ‡å‡†å‹S5**:
```
CPU: 8æ ¸
å†…å­˜: 16GB
ç¡¬ç›˜: 200GB SSDäº‘ç¡¬ç›˜
å¸¦å®½: 20Mbps
æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS
ä»·æ ¼: Â¥536/æœˆ (å¹´ä»˜ä¼˜æƒ )
```

### 1.2 æœåŠ¡å™¨è´­ä¹°æ­¥éª¤

1. **æ³¨å†Œè…¾è®¯äº‘è´¦å·**
   - è®¿é—®: https://cloud.tencent.com
   - å®Œæˆå®åè®¤è¯ï¼ˆä¼ä¸š/ä¸ªäººï¼‰

2. **é¢†å–æ–°ç”¨æˆ·ä¼˜æƒ åˆ¸**
   - æ–°ç”¨æˆ·å¯é¢†å–2860å…ƒä»£é‡‘åˆ¸
   - é¦–å¹´è´­ä¹°äº«å—æŠ˜æ‰£

3. **é€‰è´­æœåŠ¡å™¨**
   - åœ°åŸŸï¼šæ¨è"å¹¿å·"æˆ–"ä¸Šæµ·"ï¼ˆå›½å†…å»¶è¿Ÿä½ï¼‰
   - é•œåƒï¼šCentOS 7.9 æˆ– Ubuntu 20.04
   - ç½‘ç»œï¼šé»˜è®¤VPCå³å¯
   - å®‰å…¨ç»„ï¼šå¼€æ”¾ç«¯å£ 22, 80, 443, 3000, 8888

4. **è´­ä¹°å…¶ä»–èµ„æº**
   - **MySQLäº‘æ•°æ®åº“**: Â¥150/æœˆèµ·ï¼ˆæ¨èï¼‰
   - **Redisäº‘æ•°æ®åº“**: Â¥50/æœˆèµ·ï¼ˆæ¨èï¼‰
   - **COSå¯¹è±¡å­˜å‚¨**: Â¥0.1/GB/æœˆï¼ˆæŒ‰é‡ä»˜è´¹ï¼‰

### 1.3 åˆå§‹å®‰å…¨é…ç½®

ç™»å½•æœåŠ¡å™¨åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# SSHç™»å½•
ssh root@æ‚¨çš„æœåŠ¡å™¨IP

# æ›´æ–°ç³»ç»Ÿ
yum update -y  # CentOS
# æˆ–
apt update && apt upgrade -y  # Ubuntu

# ä¿®æ”¹rootå¯†ç 
passwd

# åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
adduser jimao
usermod -aG sudo jimao

# é…ç½®é˜²ç«å¢™
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --permanent --add-port=8888/tcp
firewall-cmd --reload
```

---

## 2. å®å¡”é¢æ¿å®‰è£…

### 2.1 ä¸€é”®å®‰è£…è„šæœ¬

#### **CentOS 7.x**
```bash
yum install -y wget && wget -O install.sh https://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec
```

#### **Ubuntu 20.04**
```bash
wget -O install.sh https://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh ed8484bec
```

### 2.2 å®‰è£…è¿‡ç¨‹

å®‰è£…å¤§çº¦éœ€è¦5-10åˆ†é’Ÿï¼Œå®‰è£…å®Œæˆåä¼šæ˜¾ç¤ºï¼š

```
==================================================================
Congratulations! Installed successfully!
==================================================================
å¤–ç½‘é¢æ¿åœ°å€: http://æ‚¨çš„IP:8888/abc12345
å†…ç½‘é¢æ¿åœ°å€: http://172.x.x.x:8888/abc12345
username: admin
password: a1b2c3d4
If you cannot access the panel,
release the following panel port [8888] in the security group
è‹¥æ— æ³•è®¿é—®é¢æ¿ï¼Œè¯·åœ¨å®‰å…¨ç»„æ”¾è¡Œ 8888 ç«¯å£
==================================================================
```

**é‡è¦**: ä¿å­˜å¥½ä»¥ä¸Šä¿¡æ¯ï¼

### 2.3 é¦–æ¬¡ç™»å½•å®å¡”é¢æ¿

1. **è®¿é—®é¢æ¿åœ°å€**
   ```
   http://æ‚¨çš„æœåŠ¡å™¨IP:8888/abc12345
   ```

2. **ä½¿ç”¨åˆå§‹è´¦å·å¯†ç ç™»å½•**

3. **ç»‘å®šå®å¡”è´¦å·**ï¼ˆæ¨èï¼‰
   - æ³¨å†Œå®å¡”å®˜ç½‘è´¦å·
   - ç»‘å®šåå¯ä½¿ç”¨å¾®ä¿¡æ‰«ç ç™»å½•

4. **å®‰è£…æ¨èå¥—ä»¶**
   - é€‰æ‹© **LNMPï¼ˆæ¨èï¼‰** æˆ– LAMP
   - Nginx 1.22
   - MySQL 8.0
   - PHP 8.0ï¼ˆå¤‡ç”¨ï¼‰
   - phpMyAdminï¼ˆå¯é€‰ï¼‰
   - Redis 7.0

   ç‚¹å‡»"ä¸€é”®å®‰è£…"ï¼Œç­‰å¾…15-30åˆ†é’Ÿ

---

## 3. ç¯å¢ƒé…ç½®

### 3.1 å®‰è£…Node.js 18

å®å¡”é¢æ¿æ²¡æœ‰ç›´æ¥çš„Node.jså®‰è£…ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ï¼š

#### æ–¹æ³•1ï¼šä½¿ç”¨NVMï¼ˆæ¨èï¼‰

```bash
# SSHç™»å½•æœåŠ¡å™¨
ssh root@æ‚¨çš„IP

# å®‰è£…NVM
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.5/install.sh | bash

# é‡æ–°åŠ è½½é…ç½®
source ~/.bashrc

# å®‰è£…Node.js 18
nvm install 18
nvm use 18
nvm alias default 18

# éªŒè¯å®‰è£…
node -v  # åº”æ˜¾ç¤º v18.x.x
npm -v   # åº”æ˜¾ç¤º 9.x.x
```

#### æ–¹æ³•2ï¼šä½¿ç”¨å®å¡”æ’ä»¶

1. ç™»å½•å®å¡”é¢æ¿
2. ç‚¹å‡»å·¦ä¾§èœå• **"è½¯ä»¶å•†åº—"**
3. æœç´¢ **"Nodeç‰ˆæœ¬ç®¡ç†å™¨"**
4. å®‰è£…æ’ä»¶
5. åœ¨æ’ä»¶ä¸­é€‰æ‹©å®‰è£… **Node.js 18.x**

### 3.2 å®‰è£…PM2ï¼ˆè¿›ç¨‹ç®¡ç†ï¼‰

```bash
# å…¨å±€å®‰è£…PM2
npm install -g pm2

# è®¾ç½®PM2å¼€æœºè‡ªå¯
pm2 startup
pm2 save

# éªŒè¯å®‰è£…
pm2 -v
```

### 3.3 å®‰è£…Puppeteerä¾èµ–

Puppeteeréœ€è¦é¢å¤–çš„ç³»ç»Ÿä¾èµ–ï¼š

#### **CentOS 7**
```bash
yum install -y \
  pango.x86_64 \
  libXcomposite.x86_64 \
  libXcursor.x86_64 \
  libXdamage.x86_64 \
  libXext.x86_64 \
  libXi.x86_64 \
  libXtst.x86_64 \
  cups-libs.x86_64 \
  libXScrnSaver.x86_64 \
  libXrandr.x86_64 \
  GConf2.x86_64 \
  alsa-lib.x86_64 \
  atk.x86_64 \
  gtk3.x86_64 \
  ipa-gothic-fonts \
  xorg-x11-fonts-100dpi \
  xorg-x11-fonts-75dpi \
  xorg-x11-utils \
  xorg-x11-fonts-cyrillic \
  xorg-x11-fonts-Type1 \
  xorg-x11-fonts-misc
```

#### **Ubuntu 20.04**
```bash
apt-get install -y \
  gconf-service \
  libasound2 \
  libatk1.0-0 \
  libc6 \
  libcairo2 \
  libcups2 \
  libdbus-1-3 \
  libexpat1 \
  libfontconfig1 \
  libgcc1 \
  libgconf-2-4 \
  libgdk-pixbuf2.0-0 \
  libglib2.0-0 \
  libgtk-3-0 \
  libnspr4 \
  libpango-1.0-0 \
  libpangocairo-1.0-0 \
  libstdc++6 \
  libx11-6 \
  libx11-xcb1 \
  libxcb1 \
  libxcomposite1 \
  libxcursor1 \
  libxdamage1 \
  libxext6 \
  libxfixes3 \
  libxi6 \
  libxrandr2 \
  libxrender1 \
  libxss1 \
  libxtst6 \
  ca-certificates \
  fonts-liberation \
  libappindicator1 \
  libnss3 \
  lsb-release \
  xdg-utils \
  wget
```

---

## 4. æ•°æ®åº“é…ç½®

### 4.1 MySQLé…ç½®

#### æ–¹æ³•1ï¼šä½¿ç”¨å®å¡”é¢æ¿å†…ç½®MySQL

1. **è¿›å…¥å®å¡”é¢æ¿ â†’ æ•°æ®åº“**
2. **æ·»åŠ æ•°æ®åº“**
   - æ•°æ®åº“åï¼š`jimao_amazon`
   - ç”¨æˆ·åï¼š`jimao_user`
   - å¯†ç ï¼šç”Ÿæˆå¼ºå¯†ç ï¼ˆå»ºè®®20ä½ï¼‰
   - è®¿é—®æƒé™ï¼šæœ¬åœ°æœåŠ¡å™¨

3. **å¯¼å…¥æ•°æ®åº“ç»“æ„**
   ```bash
   # ä¸Šä¼ SQLæ–‡ä»¶åˆ°æœåŠ¡å™¨
   scp database/schema.sql root@æ‚¨çš„IP:/root/

   # SSHç™»å½•æœåŠ¡å™¨ï¼Œå¯¼å…¥SQL
   mysql -u jimao_user -p jimao_amazon < /root/schema.sql
   ```

#### æ–¹æ³•2ï¼šä½¿ç”¨è…¾è®¯äº‘MySQLäº‘æ•°æ®åº“ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

1. **è´­ä¹°MySQLäº‘æ•°æ®åº“**
   - è®¿é—®: https://cloud.tencent.com/product/cdb
   - ç‰ˆæœ¬ï¼šMySQL 8.0
   - è§„æ ¼ï¼š4æ ¸8GBï¼ˆÂ¥150/æœˆï¼‰
   - å­˜å‚¨ï¼š100GB

2. **é…ç½®ç™½åå•**
   - è¿›å…¥MySQLæ§åˆ¶å°
   - æ·»åŠ æœåŠ¡å™¨IPåˆ°ç™½åå•

3. **åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·**
   ```sql
   CREATE DATABASE jimao_amazon CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   CREATE USER 'jimao_user'@'%' IDENTIFIED BY 'your_strong_password';
   GRANT ALL PRIVILEGES ON jimao_amazon.* TO 'jimao_user'@'%';
   FLUSH PRIVILEGES;
   ```

### 4.2 Redisé…ç½®

#### æ–¹æ³•1ï¼šä½¿ç”¨å®å¡”é¢æ¿å†…ç½®Redis

1. **è¿›å…¥å®å¡”é¢æ¿ â†’ è½¯ä»¶å•†åº—**
2. **æœç´¢"Redis"ï¼Œå®‰è£…**
3. **é…ç½®Rediså¯†ç **
   ```bash
   # ç¼–è¾‘Redisé…ç½®
   vi /etc/redis.conf
   
   # æ‰¾åˆ° requirepass è¡Œï¼Œå–æ¶ˆæ³¨é‡Šå¹¶è®¾ç½®å¯†ç 
   requirepass your_redis_password
   
   # é‡å¯Redis
   systemctl restart redis
   ```

#### æ–¹æ³•2ï¼šä½¿ç”¨è…¾è®¯äº‘Redisäº‘æ•°æ®åº“

1. **è´­ä¹°Redisäº‘æ•°æ®åº“**
   - ç‰ˆæœ¬ï¼šRedis 7.0
   - è§„æ ¼ï¼š1GBå†…å­˜ï¼ˆÂ¥50/æœˆï¼‰

2. **è·å–è¿æ¥ä¿¡æ¯**
   - å†…ç½‘åœ°å€
   - ç«¯å£ï¼ˆé»˜è®¤6379ï¼‰
   - å¯†ç 

---

## 5. åº”ç”¨éƒ¨ç½²

### 5.1 ä»£ç ä¸Šä¼ 

#### æ–¹æ³•1ï¼šä½¿ç”¨Gitï¼ˆæ¨èï¼‰

```bash
# SSHç™»å½•æœåŠ¡å™¨
ssh root@æ‚¨çš„IP

# è¿›å…¥ç½‘ç«™ç›®å½•
cd /www/wwwroot

# å…‹éš†ä»£ç ä»“åº“
git clone https://github.com/yourusername/jimao-amazon-backend.git
cd jimao-amazon-backend

# å®‰è£…ä¾èµ–
npm install --production
```

#### æ–¹æ³•2ï¼šä½¿ç”¨å®å¡”é¢æ¿ä¸Šä¼ 

1. **æ‰“åŒ…æœ¬åœ°ä»£ç **
   ```bash
   # åœ¨æœ¬åœ°å¼€å‘æœºå™¨ä¸Š
   tar -czf jimao-backend.tar.gz backend/
   ```

2. **ä¸Šä¼ åˆ°æœåŠ¡å™¨**
   - å®å¡”é¢æ¿ â†’ æ–‡ä»¶ â†’ ä¸Šä¼ 
   - ä¸Šä¼ åˆ° `/www/wwwroot/`
   - è§£å‹ç¼©

### 5.2 ç¯å¢ƒå˜é‡é…ç½®

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/jimao-amazon-backend

# åˆ›å»º.envæ–‡ä»¶
vi .env
```

**å¡«å…¥ä»¥ä¸‹å†…å®¹**:
```bash
# åº”ç”¨é…ç½®
NODE_ENV=production
PORT=3000
APP_NAME=å³è´¸Amazonè¯„è®ºåˆ†æ
APP_URL=https://api.yourdomain.com

# æ•°æ®åº“é…ç½®ï¼ˆæœ¬åœ°MySQLï¼‰
DB_HOST=127.0.0.1
DB_PORT=3306
DB_NAME=jimao_amazon
DB_USER=jimao_user
DB_PASSWORD=your_mysql_password

# æˆ–ä½¿ç”¨è…¾è®¯äº‘MySQL
# DB_HOST=cdb-xxxxxx.sql.tencentcdb.com
# DB_PORT=10234

# Redisé…ç½®
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password

# JWTé…ç½®
JWT_SECRET=your_jwt_secret_min_32_characters_here_abc123xyz789
JWT_EXPIRES_IN=7d

# AI APIé…ç½®
OPENAI_API_KEY=sk-proj-xxx
ANTHROPIC_API_KEY=sk-ant-xxx
ZHIPU_API_KEY=xxx

# è…¾è®¯äº‘COSé…ç½®
COS_SECRET_ID=AKIDxxxxxxxxxxxxxxxx
COS_SECRET_KEY=xxxxxxxxxxxxxxxx
COS_BUCKET=jimao-reports-1234567890
COS_REGION=ap-guangzhou

# åŠ å¯†å¯†é’¥ï¼ˆç”Ÿæˆæ–¹å¼è§ä¸‹ï¼‰
ENCRYPTION_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
```

**ç”ŸæˆåŠ å¯†å¯†é’¥**:
```bash
# ç”Ÿæˆ32å­—èŠ‚éšæœºå¯†é’¥
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### 5.3 ä½¿ç”¨PM2å¯åŠ¨åº”ç”¨

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/jimao-amazon-backend

# ä½¿ç”¨PM2å¯åŠ¨
pm2 start src/app.js --name jimao-api -i 2

# å‚æ•°è¯´æ˜ï¼š
# -i 2 è¡¨ç¤ºå¯åŠ¨2ä¸ªè¿›ç¨‹ï¼ˆclusteræ¨¡å¼ï¼‰
# --name æŒ‡å®šåº”ç”¨åç§°

# æŸ¥çœ‹æ—¥å¿—
pm2 logs jimao-api

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# ä¿å­˜PM2é…ç½®
pm2 save
```

**PM2é…ç½®æ–‡ä»¶ï¼ˆecosystem.config.jsï¼‰**:
```javascript
module.exports = {
  apps: [{
    name: 'jimao-api',
    script: './src/app.js',
    instances: 2,
    exec_mode: 'cluster',
    env_production: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/pm2-error.log',
    out_file: './logs/pm2-out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    max_memory_restart: '500M',
    autorestart: true,
    watch: false
  }]
};
```

ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨ï¼š
```bash
pm2 start ecosystem.config.js --env production
```

### 5.4 éªŒè¯éƒ¨ç½²

```bash
# æµ‹è¯•APIæ˜¯å¦æ­£å¸¸
curl http://localhost:3000/api/v1/health

# åº”è¿”å›
{"success":true,"message":"API is running"}
```

---

## 6. åŸŸåä¸HTTPSé…ç½®

### 6.1 åŸŸåè§£æ

1. **è´­ä¹°åŸŸå**ï¼ˆå¦‚ï¼šapi.jimao.comï¼‰

2. **æ·»åŠ DNSè§£æ**
   - ç™»å½•åŸŸåæ§åˆ¶å°
   - æ·»åŠ Aè®°å½•ï¼š
     ```
     ä¸»æœºè®°å½•: api
     è®°å½•ç±»å‹: A
     è®°å½•å€¼: æ‚¨çš„æœåŠ¡å™¨IP
     TTL: 600
     ```

3. **éªŒè¯è§£æ**
   ```bash
   ping api.jimao.com
   # åº”è¿”å›æ‚¨çš„æœåŠ¡å™¨IP
   ```

### 6.2 å®å¡”é¢æ¿é…ç½®ç«™ç‚¹

1. **è¿›å…¥å®å¡”é¢æ¿ â†’ ç½‘ç«™**
2. **æ·»åŠ ç«™ç‚¹**
   - åŸŸåï¼š`api.jimao.com`
   - æ ¹ç›®å½•ï¼š`/www/wwwroot/jimao-amazon-backend`
   - PHPç‰ˆæœ¬ï¼šçº¯é™æ€
   - æ•°æ®åº“ï¼šä¸åˆ›å»º

3. **é…ç½®åå‘ä»£ç†**
   - ç‚¹å‡»ç«™ç‚¹ â†’ è®¾ç½® â†’ åå‘ä»£ç†
   - æ·»åŠ åå‘ä»£ç†ï¼š
     ```
     ä»£ç†åç§°: å³è´¸API
     ç›®æ ‡URL: http://127.0.0.1:3000
     å‘é€åŸŸå: $host
     ```
   - ä¿å­˜

### 6.3 é…ç½®SSLè¯ä¹¦ï¼ˆHTTPSï¼‰

#### æ–¹æ³•1ï¼šä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦ï¼ˆæ¨èï¼‰

1. **è¿›å…¥å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ api.jimao.com â†’ è®¾ç½®**
2. **ç‚¹å‡»"SSL" â†’ "Let's Encrypt"**
3. **å‹¾é€‰åŸŸåï¼Œç‚¹å‡»"ç”³è¯·"**
4. **ç­‰å¾…1-2åˆ†é’Ÿï¼Œè¯ä¹¦è‡ªåŠ¨ç”³è¯·å¹¶éƒ¨ç½²**
5. **å¼€å¯"å¼ºåˆ¶HTTPS"**

#### æ–¹æ³•2ï¼šä½¿ç”¨è…¾è®¯äº‘SSLè¯ä¹¦

1. **ç”³è¯·å…è´¹SSLè¯ä¹¦**
   - è®¿é—®: https://console.cloud.tencent.com/ssl
   - ç”³è¯·1å¹´å…è´¹DVè¯ä¹¦
   - å¡«å†™åŸŸåå¹¶éªŒè¯

2. **ä¸‹è½½è¯ä¹¦**
   - ä¸‹è½½Nginxæ ¼å¼è¯ä¹¦
   - åŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼š
     - `1_api.jimao.com_bundle.crt`
     - `2_api.jimao.com.key`

3. **ä¸Šä¼ åˆ°å®å¡”é¢æ¿**
   - å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ SSL â†’ å…¶ä»–è¯ä¹¦
   - ç²˜è´´è¯ä¹¦å†…å®¹
   - ä¿å­˜å¹¶éƒ¨ç½²

### 6.4 Nginxé…ç½®ä¼˜åŒ–

ç¼–è¾‘Nginxé…ç½®ï¼ˆå®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ é…ç½®æ–‡ä»¶ï¼‰ï¼š

```nginx
server {
    listen 80;
    listen 443 ssl http2;
    server_name api.jimao.com;
    
    # SSLè¯ä¹¦
    ssl_certificate /www/server/panel/vhost/cert/api.jimao.com/fullchain.pem;
    ssl_certificate_key /www/server/panel/vhost/cert/api.jimao.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # å¼ºåˆ¶HTTPS
    if ($server_port !~ 443) {
        rewrite ^(/.*)$ https://$host$1 permanent;
    }
    
    # åå‘ä»£ç†åˆ°Node.js
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # æ—¥å¿—
    access_log /www/wwwlogs/api.jimao.com.log;
    error_log /www/wwwlogs/api.jimao.com.error.log;
}
```

---

## 7. ç›‘æ§ä¸è¿ç»´

### 7.1 å®å¡”é¢æ¿ç›‘æ§

1. **ç³»ç»Ÿç›‘æ§**
   - è¿›å…¥å®å¡”é¢æ¿é¦–é¡µ
   - æŸ¥çœ‹CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
   - è®¾ç½®é¢„è­¦é˜ˆå€¼ï¼ˆCPU>80%ã€å†…å­˜>90%ï¼‰

2. **æ—¥å¿—ç®¡ç†**
   - å®å¡”é¢æ¿ â†’ æ—¥å¿—
   - æŸ¥çœ‹Nginxè®¿é—®æ—¥å¿—ã€é”™è¯¯æ—¥å¿—
   - å®šæœŸæ¸…ç†æ—§æ—¥å¿—

### 7.2 PM2ç›‘æ§

```bash
# å®æ—¶ç›‘æ§
pm2 monit

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 describe jimao-api

# æŸ¥çœ‹æ—¥å¿—
pm2 logs jimao-api --lines 100

# é‡å¯åº”ç”¨
pm2 restart jimao-api

# åœæ­¢åº”ç”¨
pm2 stop jimao-api

# åˆ é™¤åº”ç”¨
pm2 delete jimao-api
```

### 7.3 æ•°æ®åº“å¤‡ä»½

#### è‡ªåŠ¨å¤‡ä»½ï¼ˆå®å¡”é¢æ¿ï¼‰

1. **è¿›å…¥å®å¡”é¢æ¿ â†’ è®¡åˆ’ä»»åŠ¡**
2. **æ·»åŠ ä»»åŠ¡**
   - ä»»åŠ¡ç±»å‹ï¼šå¤‡ä»½æ•°æ®åº“
   - æ‰§è¡Œå‘¨æœŸï¼šæ¯å¤©å‡Œæ™¨3ç‚¹
   - å¤‡ä»½åˆ°ï¼šæœ¬åœ°ç£ç›˜ + è…¾è®¯äº‘COSï¼ˆæ¨èï¼‰
   - ä¿ç•™ä»½æ•°ï¼š7ä»½

#### æ‰‹åŠ¨å¤‡ä»½

```bash
# å¯¼å‡ºæ•°æ®åº“
mysqldump -u jimao_user -p jimao_amazon > /root/backup_$(date +%Y%m%d).sql

# å‹ç¼©å¤‡ä»½
gzip /root/backup_$(date +%Y%m%d).sql

# ä¸Šä¼ åˆ°COSï¼ˆéœ€å®‰è£…COSCMDï¼‰
coscmd upload /root/backup_$(date +%Y%m%d).sql.gz /backups/
```

### 7.4 æœåŠ¡å™¨å®‰å…¨åŠ å›º

#### ä¿®æ”¹SSHç«¯å£

```bash
# ç¼–è¾‘SSHé…ç½®
vi /etc/ssh/sshd_config

# ä¿®æ”¹ç«¯å£ï¼ˆ22 â†’ 2222ï¼‰
Port 2222

# ç¦æ­¢rootå¯†ç ç™»å½•ï¼ˆå»ºè®®é…ç½®SSHå¯†é’¥åå¯ç”¨ï¼‰
PermitRootLogin no

# é‡å¯SSHæœåŠ¡
systemctl restart sshd
```

#### å®‰è£…Fail2banï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰

```bash
# CentOS
yum install -y fail2ban

# Ubuntu
apt install -y fail2ban

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
systemctl start fail2ban
systemctl enable fail2ban
```

#### å¼€å¯å®å¡”é¢æ¿å®‰å…¨åŠŸèƒ½

1. **è¿›å…¥å®å¡”é¢æ¿ â†’ å®‰å…¨**
2. **å¼€å¯ä»¥ä¸‹åŠŸèƒ½**ï¼š
   - SSHé˜²æš´åŠ›ç ´è§£
   - ç³»ç»ŸåŠ å›º
   - Nginxé˜²ç«å¢™
   - å±è”½æ¶æ„IP

### 7.5 æ€§èƒ½ä¼˜åŒ–

#### Nginx Gzipå‹ç¼©

```nginx
# åœ¨Nginxé…ç½®ä¸­æ·»åŠ 
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
```

#### RedisæŒä¹…åŒ–

```bash
# ç¼–è¾‘Redisé…ç½®
vi /etc/redis.conf

# å¼€å¯AOFæŒä¹…åŒ–
appendonly yes
appendfilename "appendonly.aof"

# é‡å¯Redis
systemctl restart redis
```

---

## 8. å¸¸è§é—®é¢˜

### 8.1 Puppeteeræ— æ³•å¯åŠ¨

**é”™è¯¯**: `Error: Failed to launch the browser process`

**è§£å†³**:
```bash
# æ£€æŸ¥æ˜¯å¦ç¼ºå°‘ä¾èµ–
ldd $(npm root -g)/puppeteer/.local-chromium/linux-xxx/chrome-linux/chrome | grep "not found"

# å®‰è£…ç¼ºå¤±çš„ä¾èµ–ï¼ˆè§3.3èŠ‚ï¼‰
```

### 8.2 PM2åº”ç”¨è‡ªåŠ¨é‡å¯

**åŸå› **: å†…å­˜è¶…é™

**è§£å†³**:
```bash
# å¢åŠ å†…å­˜é™åˆ¶
pm2 start src/app.js --name jimao-api --max-memory-restart 1G
```

### 8.3 æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯**: `ER_ACCESS_DENIED_ERROR`

**è§£å†³**:
```bash
# æ£€æŸ¥MySQLç”¨æˆ·æƒé™
mysql -u root -p
mysql> GRANT ALL PRIVILEGES ON jimao_amazon.* TO 'jimao_user'@'localhost';
mysql> FLUSH PRIVILEGES;
```

---

## 9. éƒ¨ç½²æ£€æŸ¥æ¸…å•

### âœ… éƒ¨ç½²å‰

- [ ] æœåŠ¡å™¨å·²è´­ä¹°å¹¶å®Œæˆå®åè®¤è¯
- [ ] å®‰å…¨ç»„å·²å¼€æ”¾å¿…è¦ç«¯å£ï¼ˆ22, 80, 443, 3000, 8888ï¼‰
- [ ] åŸŸåå·²å¤‡æ¡ˆï¼ˆå›½å†…æœåŠ¡å™¨å¿…é¡»ï¼‰
- [ ] ä»£ç å·²æ¨é€åˆ°Gitä»“åº“
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆ.envæ–‡ä»¶ï¼‰

### âœ… éƒ¨ç½²ä¸­

- [ ] å®å¡”é¢æ¿å·²å®‰è£…
- [ ] Node.js 18å·²å®‰è£…
- [ ] MySQLå·²é…ç½®å¹¶å¯¼å…¥æ•°æ®åº“ç»“æ„
- [ ] Rediså·²å®‰è£…å¹¶è®¾ç½®å¯†ç 
- [ ] PM2å·²å¯åŠ¨åº”ç”¨
- [ ] Nginxåå‘ä»£ç†å·²é…ç½®
- [ ] SSLè¯ä¹¦å·²éƒ¨ç½²

### âœ… éƒ¨ç½²å

- [ ] APIå¥åº·æ£€æŸ¥é€šè¿‡ï¼ˆ`/api/v1/health`ï¼‰
- [ ] HTTPSè®¿é—®æ­£å¸¸
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] Redisè¿æ¥æ­£å¸¸
- [ ] PM2åº”ç”¨çŠ¶æ€æ­£å¸¸
- [ ] æ—¥å¿—è¾“å‡ºæ­£å¸¸
- [ ] å®šæ—¶å¤‡ä»½å·²è®¾ç½®

---

**æ–‡æ¡£ç»´æŠ¤äºº**: å³è´¸æŠ€æœ¯å›¢é˜Ÿ  
**æŠ€æœ¯æ”¯æŒ**: ops@yourdomain.com


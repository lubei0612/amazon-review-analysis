{
  "id": "snapshot_1762312479879_a1e88nhob",
  "approvalId": "approval_1762312479861_xwb2au4oq",
  "approvalTitle": "Web端报告增强 - 需求文档",
  "version": 1,
  "timestamp": "2025-11-05T03:14:39.879Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements: Web Report Enhancement (Web端报告增强)\r\n\r\n**Spec Name**: `web-report-enhancement`\r\n**Created**: 2025-11-05\r\n**Status**: Draft\r\n\r\n## 1. Problem Statement (问题陈述)\r\n\r\n当前系统存在以下关键问题：\r\n\r\n### 1.1 紧急技术问题\r\n- **API配额耗尽**：Gemini API配额已用完，导致所有分析失败\r\n- **数据渲染错误**：前端显示旧的缓存数据（耳机案例）而非最新分析结果\r\n- **路由配置问题**：从详情页点击首页图标无法正确返回\r\n- **用户体验问题**：创建报告后直接跳转到详情页等待，而非在列表中显示进度\r\n\r\n### 1.2 功能缺失（对标 Shulex VOC）\r\n参考网站：https://apps.voc.ai/voc\r\n- 缺少报告元数据展示（分析的商品名称、评论数、创建时间）\r\n- 缺少PDF报告下载功能\r\n- 消费者画像缺少总结（最常提到的人群特征、使用时刻、使用地点、行为）\r\n- 原评论无法放大查看完整内容\r\n- 所有数据一次性渲染，缺少\"加载更多\"功能（应默认显示10条）\r\n- 缺少竞品分析功能\r\n- 评论抓取量限制（当前100条，Shulex可达19,836条）\r\n- 缺少翻译功能\r\n\r\n### 1.3 项目管理问题\r\n- 缺少规范的Git代码管理\r\n- Docker部署方案不完善\r\n- 项目文件混乱（文档散落各处，多余的.bat文件）\r\n\r\n## 2. User Stories (用户故事)\r\n\r\n### 2.1 核心修复 (P0 - Critical)\r\n\r\n**US-001: API配额管理**\r\n```gherkin\r\nAs a: 系统管理员\r\nI want to: 优雅地处理API配额耗尽的情况\r\nSo that: 用户能看到清晰的错误提示，而非系统崩溃\r\n\r\nGIVEN API配额已耗尽\r\nWHEN 用户发起新的分析任务\r\nTHEN 系统应返回友好的错误提示\r\nAND 建议用户联系管理员或充值\r\nAND 不应该返回旧的缓存数据\r\n```\r\n\r\n**US-002: 数据缓存清理**\r\n```gherkin\r\nAs a: 终端用户\r\nI want to: 看到最新的分析结果\r\nSo that: 我能基于准确数据做决策\r\n\r\nGIVEN 新的分析任务已完成\r\nWHEN 我查看报告详情页\r\nTHEN 应显示最新的分析数据\r\nAND 清除所有旧的缓存数据\r\nAND 如果分析失败，应显示错误而非旧数据\r\n```\r\n\r\n**US-003: 路由导航修复**\r\n```gherkin\r\nAs a: 终端用户\r\nI want to: 从报告详情页返回首页\r\nSo that: 我能继续浏览其他报告\r\n\r\nGIVEN 我在报告详情页\r\nWHEN 我点击侧边栏的\"首页\"图标\r\nTHEN 应正确跳转到首页\r\nAND 显示完整的报告列表\r\n```\r\n\r\n**US-004: 报告创建体验优化**\r\n```gherkin\r\nAs a: 终端用户\r\nI want to: 在首页创建报告并查看进度\r\nSo that: 我能在列表中管理多个分析任务\r\n\r\nGIVEN 我在首页点击\"Create Report\"\r\nWHEN 我输入ASIN并确认\r\nTHEN 应在首页报告列表中新增一条记录\r\nAND 显示\"分析中\"状态和进度条\r\nAND 我可以继续浏览或创建其他报告\r\nAND 分析完成后，列表中的状态更新为\"已完成\"\r\n```\r\n\r\n### 2.2 功能增强 (P1 - High Priority)\r\n\r\n**US-005: 报告元数据展示**\r\n```gherkin\r\nAs a: 终端用户\r\nI want to: 在报告详情页看到完整的元数据\r\nSo that: 我了解分析的范围和质量\r\n\r\nGIVEN 我打开一个报告详情页\r\nWHEN 页面加载完成\r\nTHEN 应在顶部显示：\r\n  - 产品名称（中英文）\r\n  - 产品图片\r\n  - ASIN\r\n  - 已分析评论数（如：19,836）\r\n  - 分析时间\r\n  - 下载PDF按钮\r\n```\r\n\r\n**US-006: PDF报告导出**\r\n```gherkin\r\nAs a: 终端用户\r\nI want to: 下载完整的分析报告为PDF\r\nSo that: 我能离线查看或分享给同事\r\n\r\nGIVEN 我在报告详情页\r\nWHEN 我点击\"下载报告\"按钮\r\nTHEN 系统生成包含所有分析内容的PDF文件\r\nAND 自动下载到本地\r\nAND PDF包含所有图表、数据和格式\r\n```\r\n\r\n**US-007: 消费者画像总结**\r\n```gherkin\r\nAs a: 市场分析师\r\nI want to: 快速了解消费者画像的关键洞察\r\nSo that: 我能在30秒内抓住核心信息\r\n\r\nGIVEN 我查看消费者画像模块\r\nWHEN 页面渲染完成\r\nTHEN 应在顶部显示总结文本：\r\n  \"消费者最常提到的人群特征是son，使用时刻是everyday，\r\n   使用地点是gym，行为是workout。关注这些热门关键词，\r\n   挖掘消费者使用场景背后的痛点。\"\r\nAND 总结基于数据自动生成\r\n```\r\n\r\n**US-008: 原评论弹窗查看**\r\n```gherkin\r\nAs a: 终端用户\r\nI want to: 点击原评论卡片查看完整内容\r\nSo that: 我能阅读被省略的长评论\r\n\r\nGIVEN 消费者画像或其他模块展示了原评论示例\r\nWHEN 我点击某条评论卡片\r\nTHEN 弹出一个模态窗口\r\nAND 显示完整的评论内容（无省略号）\r\nAND 包含：评论者、评分、时间、完整文本\r\nAND 可以点击\"关闭\"或遮罩关闭\r\n```\r\n\r\n**US-009: 数据分页加载**\r\n```gherkin\r\nAs a: 终端用户\r\nI want to: 默认只看到前10条数据\r\nSo that: 页面加载速度快，不会被信息淹没\r\n\r\nGIVEN 任何数据列表模块（使用场景、产品体验等）\r\nWHEN 页面首次加载\r\nTHEN 默认显示前10条数据\r\nAND 底部显示\"加载更多\"按钮\r\nAND 点击后加载下一批10条\r\nAND 如果数据少于10条，不显示按钮\r\n```\r\n\r\n### 2.3 高级功能 (P2 - Medium Priority)\r\n\r\n**US-010: 竞品分析**\r\n```gherkin\r\nAs a: 产品经理\r\nI want to: 对比多个竞品的分析数据\r\nSo that: 我能识别市场机会和威胁\r\n\r\nGIVEN 我在报告详情页\r\nWHEN 我点击\"竞品分析\"标签\r\nTHEN 显示对比表格\r\nAND 包含4-5个竞品的核心数据（参考Shulex）\r\nAND 可以点击竞品ASIN跳转到对应报告\r\n```\r\n\r\n**US-011: 大规模评论抓取**\r\n```gherkin\r\nAs a: 数据分析师\r\nI want to: 分析超过100条评论（理想情况下1000-20000条）\r\nSo that: 我能获得更全面和准确的洞察\r\n\r\nGIVEN 我创建一个新的分析任务\r\nWHEN 我选择\"深度分析\"模式\r\nTHEN 系统尝试抓取最多20,000条评论\r\nAND 使用分批分析策略（避免AI token限制）\r\nAND 显示实时进度（已抓取 X / 目标 Y）\r\n```\r\n\r\n**US-012: 国际化翻译**\r\n```gherkin\r\nAs a: 国际用户\r\nI want to: 选择界面语言（中文/英文）\r\nSo that: 我能用母语阅读报告\r\n\r\nGIVEN 我在任意页面\r\nWHEN 我点击语言切换按钮\r\nTHEN 界面文本切换到对应语言\r\nAND 语言选择保存到localStorage\r\nAND 下次访问时记住我的选择\r\n```\r\n\r\n### 2.4 技术债务 (P2 - Medium Priority)\r\n\r\n**US-013: Git代码管理**\r\n```gherkin\r\nAs a: 开发者\r\nI want to: 规范的Git仓库和提交历史\r\nSo that: 我能追踪代码变更和协作开发\r\n\r\nGIVEN 项目已初始化Git仓库\r\nWHEN 我查看commit历史\r\nTHEN 看到清晰的提交信息\r\nAND 敏感文件（.env）被.gitignore排除\r\nAND 有合理的分支策略\r\n```\r\n\r\n**US-014: Docker部署优化**\r\n```gherkin\r\nAs a: DevOps工程师\r\nI want to: 一键部署到腾讯云\r\nSo that: 我能快速发布到生产环境\r\n\r\nGIVEN Docker Compose文件已配置\r\nWHEN 我运行docker-compose up\r\nTHEN 前后端服务同时启动\r\nAND 环境变量从.env加载\r\nAND Nginx反向代理配置正确\r\nAND 服务健康检查通过\r\n```\r\n\r\n**US-015: 项目文件整理**\r\n```gherkin\r\nAs a: 维护者\r\nI want to: 清晰的项目文件结构\r\nSo that: 我能快速找到需要的文件\r\n\r\nGIVEN 项目根目录\r\nWHEN 我浏览文件结构\r\nTHEN 所有文档集中在docs/文件夹\r\nAND 删除了多余的.bat文件（保留必要的）\r\nAND README指向正确的文档\r\nAND 有清晰的文件夹命名约定\r\n```\r\n\r\n## 3. Acceptance Criteria (验收标准)\r\n\r\n### 3.1 功能性标准\r\n\r\n1. **数据准确性**：\r\n   - ✅ 新分析的数据正确显示，不混淆旧数据\r\n   - ✅ API失败时显示错误，不返回缓存数据\r\n   - ✅ 每个维度的数据与AI分析结果一致\r\n\r\n2. **用户体验**：\r\n   - ✅ 创建报告后留在首页，列表中显示进度\r\n   - ✅ 从详情页可正确返回首页\r\n   - ✅ 默认显示10条数据，支持加载更多\r\n   - ✅ 原评论可点击放大查看\r\n\r\n3. **性能**：\r\n   - ✅ 首页加载时间 < 2秒\r\n   - ✅ 报告详情页加载时间 < 3秒\r\n   - ✅ PDF生成时间 < 10秒\r\n   - ✅ 支持分析1000+条评论（分批处理）\r\n\r\n4. **可靠性**：\r\n   - ✅ API失败时优雅降级\r\n   - ✅ 网络错误时显示友好提示\r\n   - ✅ 浏览器刷新不丢失状态\r\n\r\n### 3.2 非功能性标准\r\n\r\n1. **代码质量**：\r\n   - ✅ ESLint无错误\r\n   - ✅ 组件复用率 > 60%\r\n   - ✅ 关键函数有注释\r\n\r\n2. **部署**：\r\n   - ✅ Docker镜像构建成功\r\n   - ✅ 一键部署到腾讯云\r\n   - ✅ 服务健康检查通过\r\n\r\n3. **文档**：\r\n   - ✅ README完整清晰\r\n   - ✅ 部署文档准确\r\n   - ✅ API文档更新\r\n\r\n## 4. Out of Scope (不包含的范围)\r\n\r\n- ❌ 用户认证和权限管理（未来版本）\r\n- ❌ 实时协作编辑报告（未来版本）\r\n- ❌ 移动端原生APP（未来版本）\r\n- ❌ 自动定时分析（未来版本）\r\n- ❌ 邮件通知功能（未来版本）\r\n\r\n## 5. Dependencies & Risks (依赖和风险)\r\n\r\n### 5.1 外部依赖\r\n\r\n| 依赖项 | 状态 | 风险级别 | 缓解措施 |\r\n|--------|------|----------|----------|\r\n| Gemini API | 配额耗尽 | 🔴 High | 立即充值或更换API Key |\r\n| Apify API | 正常 | 🟡 Medium | 监控配额使用，设置告警 |\r\n| 腾讯云服务器 | 待确认 | 🟡 Medium | 提前申请资源和权限 |\r\n\r\n### 5.2 技术风险\r\n\r\n| 风险 | 概率 | 影响 | 应对策略 |\r\n|------|------|------|----------|\r\n| 大规模评论抓取可能被Amazon限流 | High | High | 实现速率限制和重试机制 |\r\n| PDF生成占用大量服务器资源 | Medium | Medium | 使用队列异步处理 |\r\n| 前端状态管理复杂度增加 | Medium | Low | 使用Pinia进行集中状态管理 |\r\n\r\n## 6. Success Metrics (成功指标)\r\n\r\n### 6.1 业务指标\r\n\r\n- 📊 报告创建成功率 > 95%\r\n- 📊 用户停留时间 > 5分钟\r\n- 📊 PDF下载率 > 30%\r\n\r\n### 6.2 技术指标\r\n\r\n- 📊 API错误率 < 2%\r\n- 📊 页面加载时间 < 3秒（P95）\r\n- 📊 服务器CPU使用率 < 70%\r\n\r\n### 6.3 用户满意度\r\n\r\n- 📊 客户反馈评分 > 4.5/5\r\n- 📊 Bug报告 < 5个/周\r\n\r\n## 7. Timeline & Phases (时间线和阶段)\r\n\r\n### Phase 1: 紧急修复（1天）\r\n- 修复API配额问题\r\n- 修复数据缓存问题\r\n- 修复路由导航\r\n- 优化创建报告流程\r\n\r\n### Phase 2: 核心功能增强（2-3天）\r\n- 报告元数据展示\r\n- PDF导出功能\r\n- 消费者画像总结\r\n- 原评论弹窗\r\n- 数据分页加载\r\n\r\n### Phase 3: 高级功能（3-4天）\r\n- 竞品分析\r\n- 大规模评论抓取\r\n- 国际化翻译\r\n\r\n### Phase 4: 技术债务清理（1-2天）\r\n- Git代码管理\r\n- Docker部署优化\r\n- 项目文件整理\r\n\r\n**总预估时间：7-10天**\r\n\r\n## 8. References (参考资料)\r\n\r\n- Shulex VOC: https://apps.voc.ai/voc\r\n- Apify API文档: https://docs.apify.com/\r\n- Vue 3官方文档: https://vuejs.org/\r\n- Element Plus: https://element-plus.org/\r\n- jsPDF: https://github.com/parallax/jsPDF\r\n\r\n## 9. Approval (批准)\r\n\r\n- [ ] Product Owner: 用户需求确认\r\n- [ ] Tech Lead: 技术可行性确认\r\n- [ ] Designer: UI/UX设计确认\r\n\r\n---\r\n\r\n**Next Steps**: \r\n1. 获得需求批准\r\n2. 创建 `design.md` 设计文档\r\n3. 创建 `tasks.md` 任务清单\r\n4. 开始实施\r\n\r\n",
  "fileStats": {
    "size": 11159,
    "lines": 385,
    "lastModified": "2025-11-05T03:14:30.517Z"
  },
  "comments": []
}
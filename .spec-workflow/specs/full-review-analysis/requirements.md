# Requirements Document - 全量评论分析与UI优化

## Introduction

基于参考示例，设计一个支持全量评论爬取和深度AI分析的系统，并优化消费者画像的可视化展示。

### 背景

当前系统存在的问题：
- ❌ 评论爬取数量限制（默认500条，实际可能更少）
- ❌ 消费者画像分析不够细致（缺少性别比例、人群细分）
- ❌ UI展示较为简单，缺少可视化图表
- ❌ 分析维度与参考示例有差距

### 参考示例分析

**优秀的分析维度：**
1. **消费者画像**：
   - 性别比例（男7% vs 女31%）+ 可视化
   - 人群特征：婴儿24%、幼儿14%、孕女10%
   - 使用时刻：生日14%、复活节10%、特殊场合7%
   - 使用地点：生日14%、复活节10%、婚礼9%
   - 行为：礼物16%、摄影10%、等方9%

2. **使用场景**（26%~12%比例展示）
3. **未被满足的需求**（10%~12%，具体原因描述）
4. **好评**（57%~17%，高占比突出）
5. **差评**（19%~10%，问题明确）
6. **购买动机**（19%~10%，动机清晰）

### 目标

实现一个**可交付的完整版本**，包括：
- ✅ 支持全量评论爬取（500+甚至1000+）
- ✅ 深度消费者画像分析（性别、人群、时刻、地点、行为）
- ✅ 优化的UI可视化（性别比例图、横向条形图）
- ✅ 更详细的分析原因说明
- ✅ 百分比精确到小数点后2位

---

## Requirements

### Requirement 1: 全量评论爬取支持

**User Story:** 作为分析师，我希望系统能够爬取产品的所有评论，以便进行更全面的分析。

#### Acceptance Criteria

1. WHEN 用户发起分析请求 THEN 系统 SHALL 尝试爬取所有可用评论
2. WHEN RapidAPI达到限制 THEN 系统 SHALL 自动切换到Puppeteer继续爬取
3. WHEN 爬取完成 THEN 系统 SHALL 记录实际爬取数量和总评论数
4. IF 评论超过1000条 THEN 系统 SHALL 智能采样（保留高质量评论）
5. WHEN 评论数据保存 THEN 系统 SHALL 去重并保存原始数据

**技术要求：**
- 移除 `maxReviews` 的硬性限制
- 实现分页爬取直到无更多数据
- 优化爬取性能（并发控制）
- 添加进度反馈

---

### Requirement 2: 深度消费者画像分析

**User Story:** 作为产品经理，我希望看到详细的消费者画像，包括性别、人群特征、使用时刻、地点和行为。

#### Acceptance Criteria

1. WHEN AI分析消费者画像 THEN 系统 SHALL 返回以下子维度：
   - `genderRatio`: { male: number, female: number, unknown: number }
   - `demographics`: [{ persona: string, percentage: number, reason: string }]
   - `usageTime`: [{ occasion: string, percentage: number, reason: string }]
   - `usageLocation`: [{ place: string, percentage: number, reason: string }]
   - `behaviors`: [{ behavior: string, percentage: number, reason: string }]

2. WHEN 计算百分比 THEN 系统 SHALL 精确到小数点后2位（如：24.57%）

3. WHEN 生成原因说明 THEN 系统 SHALL 提供具体的评论引用或总结

4. WHEN 返回结果 THEN 系统 SHALL 按占比从高到低排序

**数据格式示例：**
```json
{
  "consumerProfile": {
    "genderRatio": {
      "male": 7.23,
      "female": 31.45,
      "unknown": 61.32
    },
    "demographics": [
      {
        "persona": "婴儿父母",
        "percentage": 24.15,
        "reason": "许多评论提到为婴儿购买，年龄在0-1岁"
      }
    ],
    "usageTime": [...],
    "usageLocation": [...],
    "behaviors": [...]
  }
}
```

---

### Requirement 3: 消费者画像UI可视化优化

**User Story:** 作为用户，我希望看到直观美观的消费者画像可视化，类似参考示例。

#### Acceptance Criteria

1. WHEN 显示性别比例 THEN 系统 SHALL 使用人形图标 + 深浅色填充
   - 男性：蓝色人形图标（深色填充部分代表比例）
   - 女性：粉色人形图标（深色填充部分代表比例）
   - 自下而上填充动画

2. WHEN 显示人群特征 THEN 系统 SHALL 使用卡片式布局
   - 4列网格布局（人群特征、使用时刻、使用地点、行为）
   - 每列显示TOP 3项
   - 百分比 + 文字描述

3. WHEN 显示详细列表 THEN 系统 SHALL 使用横向条形图
   - 左侧：维度名称
   - 中间：百分比数字
   - 右侧：彩色进度条（绿色=好评，红色=差评，蓝色=中性）

4. WHEN 用户悬停 THEN 系统 SHALL 显示详细原因说明

**UI组件要求：**
- 使用 Vue 3 + Element Plus
- 响应式布局
- 平滑动画效果
- 支持导出图表

---

### Requirement 4: AI分析策略优化

**User Story:** 作为系统，我希望AI分析结果更加精准和详细，接近参考示例的质量。

#### Acceptance Criteria

1. WHEN 分析每个维度 THEN AI SHALL 提供：
   - 占比百分比（精确到小数点后2位）
   - 具体原因说明（50-100字）
   - 相关评论引用（如适用）

2. WHEN 分析消费者画像 THEN AI SHALL 识别：
   - 性别线索（he/she/him/her, 父母/母亲, 男孩/女孩等）
   - 年龄/人群线索（baby, toddler, kid, teen, adult等）
   - 使用场景线索（birthday, wedding, gift, party等）

3. WHEN 分析未满足需求 THEN AI SHALL：
   - 优先提取具体问题（而非笼统描述）
   - 每个需求附带占比和解决建议

4. WHEN 分析好评/差评 THEN AI SHALL：
   - 提取关键词（cute, quality, size等）
   - 计算sentiment强度
   - 聚类相似评论

**Prompt工程要求：**
- 更新 `PromptTemplates.js`
- 添加示例输出格式
- 强化JSON结构验证
- 增加上下文理解能力

---

### Requirement 5: 分析结果展示页面重构

**User Story:** 作为用户，我希望看到完整、美观、易懂的分析报告页面。

#### Acceptance Criteria

1. WHEN 加载报告页面 THEN 系统 SHALL 显示：
   - 顶部：产品信息 + 总体评分 + 评论总数
   - 消费者画像（性别比例 + 4维度卡片）
   - 使用场景（横向条形图，TOP 5）
   - 好评分析（横向条形图，绿色，TOP 5）
   - 差评分析（横向条形图，红色，TOP 5）
   - 未满足需求（横向条形图，橙色，TOP 5）
   - 购买动机（横向条形图，蓝色，TOP 5）
   - 星级影响度（堆叠条形图）

2. WHEN 用户滚动 THEN 系统 SHALL：
   - 渐进式加载图表（避免卡顿）
   - 显示滚动进度指示器
   - 固定导航菜单

3. WHEN 用户交互 THEN 系统 SHALL 支持：
   - 点击维度查看详情
   - 导出PDF报告
   - 分享链接

**页面布局：**
```
┌─────────────────────────────────────────┐
│  产品信息 + 总体评分                      │
├─────────────────────────────────────────┤
│  消费者画像（性别比例 + 4维度）           │
├─────────────────────────────────────────┤
│  使用场景（条形图）                       │
├─────────────────────────────────────────┤
│  好评分析（绿色条形图）                   │
├─────────────────────────────────────────┤
│  差评分析（红色条形图）                   │
├─────────────────────────────────────────┤
│  未满足需求（橙色条形图）                 │
├─────────────────────────────────────────┤
│  购买动机（蓝色条形图）                   │
├─────────────────────────────────────────┤
│  星级影响度（堆叠图）                     │
└─────────────────────────────────────────┘
```

---

## Success Metrics

验收标准：

1. **爬取能力**: 能够爬取500+评论（理想1000+）
2. **分析深度**: 消费者画像包含5个子维度
3. **UI美观度**: 性别比例可视化 + 条形图展示
4. **分析质量**: 百分比精确到小数点后2位，原因说明详细
5. **性能**: 1000条评论分析完成时间 < 3分钟

---

**文档版本**: v1.0  
**创建日期**: 2025-11-03  
**目标**: 可交付完整版本


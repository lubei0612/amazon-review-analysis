# 🧪 Amazon评论分析系统 - 完整测试指南

> **测试环境**: Windows 10 + Node.js 16+ + Chrome 110+

---

## 📋 测试前准备

### 1. 环境检查

```bash
# 检查Node版本
node -v  # >= 16.0.0

# 检查npm版本
npm -v   # >= 8.0.0

# 检查Chrome版本
chrome://version  # >= 110
```

### 2. 安装依赖

```bash
# 后端依赖
npm install

# 前端依赖
cd web
npm install
cd ..
```

### 3. 配置Groq API Key

**重要**: 必须先获取Groq API Key才能进行AI分析测试

1. 访问 https://console.groq.com/keys
2. 使用Google/GitHub登录
3. 点击"Create API Key"
4. 复制API Key（格式：`gsk_...`）
5. 打开`.env`文件，修改：
   ```
   GROQ_API_KEY=gsk_你的实际key
   ```

---

## 🔧 第一阶段：单元测试

### 测试1：后端服务启动

```bash
# 启动后端
npm run dev
```

**预期结果**：
```
╔═══════════════════════════════════════════════════════╗
║                                                       ║
║   🚀 Amazon评论分析服务已启动                        ║
║                                                       ║
║   端口: 3000                                         ║
║   环境: development                                  ║
║   时间: 2025-10-22 11:53:00                         ║
║                                                       ║
║   API地址: http://localhost:3000/api                ║
║   健康检查: http://localhost:3000/api/health        ║
║                                                       ║
╚═══════════════════════════════════════════════════════╝
```

### 测试2：API健康检查

```bash
# 新终端执行
curl http://localhost:3000/api/health
```

**预期响应**：
```json
{
  "success": true,
  "message": "Amazon评论分析服务运行中",
  "timestamp": "2025-10-22T03:53:00.000Z"
}
```

### 测试3：前端服务启动

```bash
# 新终端执行
cd web
npm run dev
```

**预期结果**：
```
VITE v5.4.21  ready in 579 ms
➜  Local:   http://localhost:3002/
➜  Network: http://10.0.8.212:3002/
```

访问 `http://localhost:3002/` 应看到报告页面

### 测试4：Chrome插件加载

1. 打开Chrome，访问 `chrome://extensions/`
2. **开启"开发者模式"**
3. 点击"加载已解压的扩展程序"
4. 选择 `chrome-extension` 文件夹

**预期结果**：
- ✅ 插件卡片显示"Amazon评论分析助手"
- ✅ 状态为"已启用"
- ✅ 工具栏出现插件图标

---

## 🚀 第二阶段：功能测试

### 测试5：插件页面检测

1. 访问Amazon产品页：
   ```
   https://www.amazon.com/dp/B08N5WRWNW
   ```

2. **检查点**：
   - ✅ 插件图标显示绿色勾号 ✓
   - ✅ 浏览器控制台（F12）输出：`Amazon评论分析助手已加载`
   - ✅ 1秒后页面右上角出现紫色浮窗

### 测试6：浮窗UI交互

在浮窗上测试：

1. **产品信息显示**：
   - ✅ 显示产品标题
   - ✅ 显示评论数量
   - ✅ 显示产品评分

2. **拖拽测试**：
   - ✅ 鼠标按住标题栏可拖动窗口

3. **最小化/关闭**：
   - ✅ 点击最小化按钮，窗口收起
   - ✅ 点击关闭按钮，窗口消失

### 测试7：Popup弹窗

1. 点击工具栏插件图标

2. **检查点**：
   - ✅ 弹出紫色渐变弹窗
   - ✅ 显示"✅ 产品页"
   - ✅ 显示评论数和评分
   - ✅ "开始分析"按钮可用

3. 点击"刷新产品信息"：
   - ✅ 数据重新加载
   - ✅ 无错误提示

---

## 🧠 第三阶段：AI分析测试

⚠️ **重要**: 此阶段需确保：
- 后端服务运行中（`http://localhost:3000`）
- 前端服务运行中（`http://localhost:3002`）
- Groq API Key已正确配置

### 测试8：Mock数据分析（快速测试）

使用Postman或curl测试API：

```bash
curl -X POST http://localhost:3000/api/tasks/create \
  -H "Content-Type: application/json" \
  -d '{
    "productUrl": "https://www.amazon.com/dp/B08N5WRWNW",
    "asin": "B08N5WRWNW",
    "reviewCount": 100,
    "cookies": "session-id=test; ubid-main=test",
    "analysisOptions": {
      "enableConsumerProfile": true,
      "enableUsageScenarios": true,
      "enableStarRating": true,
      "enableProductExperience": true,
      "enablePurchaseMotivation": true,
      "enableUnmetNeeds": true
    }
  }'
```

**预期响应**：
```json
{
  "success": true,
  "message": "任务创建成功",
  "data": {
    "taskId": "uuid-here",
    "status": "pending"
  }
}
```

**查询任务状态**：
```bash
curl http://localhost:3000/api/tasks/{taskId}/status
```

### 测试9：完整流程测试

1. **在Amazon产品页点击浮窗"开始分析"**

2. **观察后端日志**：
   ```
   [INFO] 收到分析请求: ASIN B08N5WRWNW
   [INFO] 正在启动浏览器...
   [INFO] 浏览器启动成功
   [INFO] 开始爬取 ASIN: B08N5WRWNW
   [INFO] 正在爬取第 1 页: https://...
   [INFO] 第 1 页爬取成功，获得 10 条评论
   [INFO] 爬取完成！共获得 50 条评论
   [INFO] 开始清洗 50 条评论
   [INFO] 清洗完成，有效评论 48 条
   [INFO] [1/6] 开始分析：消费者画像
   [INFO] 开始Groq AI分析...
   [INFO] Groq AI分析完成！耗时: 3.2s, Tokens: 1234
   [INFO] [2/6] 开始分析：使用场景
   ...
   [INFO] ✅ 所有维度分析完成！
   [INFO] ✅ 任务 {taskId} 完成！
   ```

3. **观察浮窗状态**：
   - ✅ 进度条从0%增长到100%
   - ✅ 状态文字变化：
     - "正在抓取评论..."
     - "AI分析中..."
     - "分析完成！"

4. **自动打开报告页面**：
   - ✅ 新标签页自动打开
   - ✅ URL: `http://localhost:3002/#/report/{taskId}`

### 测试10：报告页面展示

在报告页面检查：

1. **导航栏**：
   - ✅ 左侧导航栏显示
   - ✅ 顶部模块导航显示
   - ✅ 点击导航可跳转到对应模块

2. **消费者画像**：
   - ✅ 四列布局显示
   - ✅ 垂直条形图正常渲染
   - ✅ 红绿条形图从Y=0轴开始，重叠显示
   - ✅ X轴标签字体颜色深色可读
   - ✅ 鼠标悬停显示详细数据

3. **使用场景**：
   - ✅ 数据表格显示
   - ✅ 提及占比工具提示正常
   - ✅ 超过10条数据显示"加载更多"
   - ✅ 点击"加载更多"每次加载10条
   - ✅ 全部加载后显示"收起"按钮

4. **星级影响度**：
   - ✅ 散点图正常渲染
   - ✅ 红色/绿色文字直接显示
   - ✅ 4星参考线顶端有向上箭头
   - ✅ 参考线无文字标签

5. **产品体验**：
   - ✅ 正负面分栏显示
   - ✅ 提及占比工具提示正常
   - ✅ 正负面各自的"加载更多"功能
   - ✅ 示例文本显示

6. **购买动机**：
   - ✅ 数据表格显示
   - ✅ 提及占比工具提示正常
   - ✅ "加载更多"功能正常

7. **未被满足的需求**：
   - ✅ 数据表格显示
   - ✅ 提及占比工具提示正常
   - ✅ "加载更多"功能正常
   - ✅ 改进建议显示

---

## 🐛 第四阶段：异常处理测试

### 测试11：非产品页检测

1. 访问Amazon首页：`https://www.amazon.com/`

2. **检查点**：
   - ✅ 插件图标无勾号
   - ✅ 不注入浮窗UI
   - ✅ Popup显示"❌ 非产品页"
   - ✅ "开始分析"按钮禁用

### 测试12：Cookie失效处理

1. 清除Amazon Cookie：
   - Chrome → F12 → Application → Cookies
   - 删除`.amazon.com`的所有Cookie

2. 尝试开始分析：
   - ✅ 爬虫应报错或只能爬取有限评论
   - ✅ 后端日志显示错误信息

### 测试13：Groq API限流

如果触发Groq速率限制：

- ✅ 后端日志显示："速率限制，请等待1分钟后重试"
- ✅ 任务状态变为"failed"
- ✅ 前端显示错误提示

### 测试14：网络中断

在爬取过程中断网：

- ✅ 任务状态变为"failed"
- ✅ 后端日志显示网络错误
- ✅ 前端显示"分析失败，请重试"

---

## 📊 第五阶段：性能测试

### 测试15：大数据量处理

测试分析1000+条评论的产品：

```bash
# 示例产品：AirPods Pro（通常有2000+评论）
https://www.amazon.com/dp/B0CHWRXH8B
```

**观察指标**：
- ⏱️ 爬取时间：约2-5分钟（50页）
- 🧠 AI分析时间：约30-60秒（6个维度）
- 💾 内存占用：< 500MB
- 📊 前端渲染：流畅无卡顿

### 测试16：并发任务

同时创建3个分析任务：

**观察**：
- ✅ 任务独立执行，互不干扰
- ✅ 内存占用线性增长
- ✅ Groq速率限制自动排队

---

## ✅ 测试检查清单

### 基础功能

- [ ] 后端服务正常启动
- [ ] API健康检查通过
- [ ] 前端服务正常启动
- [ ] Chrome插件加载成功

### 插件功能

- [ ] 产品页检测正确
- [ ] 浮窗UI正常显示
- [ ] Popup弹窗正常显示
- [ ] Cookie获取成功

### 爬虫功能

- [ ] 成功爬取评论
- [ ] 数据清洗正确
- [ ] 反爬虫策略有效
- [ ] 错误处理正确

### AI分析

- [ ] Groq API连接成功
- [ ] 6个维度分析完成
- [ ] JSON格式正确
- [ ] 中文输出正常

### 前端展示

- [ ] 导航栏功能正常
- [ ] 消费者画像图表正常
- [ ] 使用场景表格正常
- [ ] 星级影响度图表正常
- [ ] 产品体验分栏正常
- [ ] 购买动机表格正常
- [ ] 未满足需求表格正常
- [ ] "加载更多"功能正常

### 异常处理

- [ ] 非产品页检测正确
- [ ] Cookie失效处理正确
- [ ] API限流处理正确
- [ ] 网络异常处理正确

---

## 🎯 测试通过标准

### ✅ 完全通过

- 所有15个测试项通过
- 无严重错误
- 性能指标达标

### ⚠️ 部分通过

- 核心功能正常
- 存在1-2个非关键错误
- 需优化但不影响使用

### ❌ 未通过

- 核心功能失败
- 存在阻塞性错误
- 需修复后重测

---

## 📝 测试报告模板

```markdown
## 测试报告

**测试日期**: 2025-10-22  
**测试环境**: Windows 10 + Node.js 16.20.0 + Chrome 120  
**测试人员**: XXX  

### 测试结果

- ✅ 基础功能: 通过
- ✅ 插件功能: 通过
- ✅ 爬虫功能: 通过
- ✅ AI分析: 通过
- ✅ 前端展示: 通过
- ✅ 异常处理: 通过

### 发现问题

1. [严重] Cookie过期后未给出明确提示
2. [一般] 爬取超时时间过长，建议调整为20秒
3. [轻微] 部分图表tooltip文字过小

### 性能数据

- 爬取50页评论耗时: 3分22秒
- AI分析6个维度耗时: 42秒
- 总耗时: 约4分钟

### 建议

1. 增加Cookie有效性检测
2. 优化爬虫超时配置
3. 调整tooltip字体大小

### 结论

✅ **测试通过，可进入下一阶段**
```

---

**🎉 完成所有测试后，恭喜你！系统已准备就绪！**

**下一步**: 
1. 录制Demo视频
2. 准备技术评审
3. 编写用户手册


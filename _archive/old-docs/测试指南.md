# 即贸 Amazon评论分析系统 - 测试指南

## ✅ 简化架构已完成！

系统已成功从 Puppeteer + Groq 简化为 Outscraper + RapidAPI + Gemini。

---

## 🎯 测试步骤

### 1️⃣ 验证后端服务

**检查后端是否正常运行：**

```bash
curl http://localhost:3001/api/health
```

**预期输出：**
```json
{
  "success": true,
  "message": "Amazon评论分析服务运行中",
  "timestamp": "2025-10-25T..."
}
```

✅ **状态：已通过** - 后端服务正常运行

---

### 2️⃣ 配置API密钥（必须）

当前系统需要配置API密钥才能正常工作。

#### 步骤A：复制环境变量模板

```bash
# Windows
copy env.example .env

# Mac/Linux
cp env.example .env
```

#### 步骤B：编辑 .env 文件，填写真实密钥

```env
# 🤖 AI分析（必填）
GEMINI_API_KEY=your_real_gemini_api_key_here

# 🕷️ 爬虫服务（至少配置一个）
OUTSCRAPER_API_KEY=your_real_outscraper_api_key_here  # 推荐
RAPIDAPI_KEY=your_real_rapidapi_key_here              # 备用
```

#### 步骤C：获取API密钥

| 服务 | 获取地址 | 免费额度 |
|------|---------|---------|
| **Gemini** | https://aistudio.google.com/app/apikey | 免费 |
| **Outscraper** | https://outscraper.com/ | 500次/月 |
| **RapidAPI** | https://rapidapi.com/ | 500次/月 |

#### 步骤D：重启后端服务

```bash
# 停止服务
Ctrl + C

# 重新启动
npm start
```

---

### 3️⃣ 启动Web前端

打开新的终端窗口：

```bash
cd web
npm run dev
```

**访问地址：** http://localhost:3002

**预期：** 能够看到Web端首页，有搜索框和报告列表

---

### 4️⃣ 测试Chrome扩展

#### 步骤A：安装扩展（如果还没有）

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 启用"开发者模式"（右上角）
4. 点击"加载已解压的扩展程序"
5. 选择项目中的 `chrome-extension` 目录

#### 步骤B：访问Amazon产品页面

访问任意Amazon产品页面，例如：
https://www.amazon.com/dp/B08N5WRWNW

#### 步骤C：点击"开始AI分析"

**预期行为：**
1. 页面顶部出现分析面板
2. 点击"开始AI分析"按钮
3. 等待60秒左右（爬取+分析）
4. 看到六维度分析结果
5. 点击"查看完整报告"跳转到Web端

**注意：** 无需登录Amazon账号，不会收集您的Cookies！

---

### 5️⃣ 测试Web端生成报告

1. 访问 http://localhost:3002
2. 在搜索框输入Amazon ASIN或产品URL
3. 例如：`B08N5WRWNW` 或 `https://www.amazon.com/dp/B08N5WRWNW`
4. 选择站点（默认US）
5. 点击"开始分析"
6. 等待分析完成
7. 查看完整的六维度报告（包含所有数据，非前5条）

---

## 🔍 验证清单

请逐项验证以下功能：

- [ ] **后端健康检查** - `curl http://localhost:3001/api/health` 返回200
- [ ] **API密钥已配置** - `.env` 文件存在且包含真实密钥
- [ ] **Web前端能访问** - http://localhost:3002 能打开首页
- [ ] **Chrome扩展已安装** - 访问Amazon页面能看到分析面板
- [ ] **Chrome扩展能分析** - 点击"开始AI分析"能成功获取结果
- [ ] **Web端能搜索** - 输入ASIN能触发分析
- [ ] **报告能生成** - 完整的六维度报告能正常显示
- [ ] **数据能导出** - 能导出Excel/PDF（如果已实现）

---

## ❓ 常见问题

### Q1: 后端启动失败，提示找不到 puppeteer-extra？

**A:** 已修复！运行以下命令重新安装依赖：

```bash
npm install
npm start
```

### Q2: API调用失败，提示"爬虫不可用"？

**A:** 需要配置API密钥：

1. 复制 `env.example` 为 `.env`
2. 填写 `GEMINI_API_KEY`（必填）
3. 填写 `OUTSCRAPER_API_KEY` 或 `RAPIDAPI_KEY`（至少一个）
4. 重启服务

### Q3: Outscraper返回0条评论？

**可能原因：**
- API Key未配置或无效
- 产品ASIN不存在
- 该产品没有评论
- API配额用完

**解决方案：**
1. 检查 `.env` 中的 `OUTSCRAPER_API_KEY` 是否正确
2. 尝试另一个有评论的产品
3. 查看 https://outscraper.com/ 账户余额

### Q4: Web前端打不开？

**解决方案：**

```bash
cd web
npm install
npm run dev
```

确保端口3002未被占用。

### Q5: Chrome扩展无法注入UI？

**检查清单：**
- [ ] 后端服务是否运行（http://localhost:3001/api/health）
- [ ] 是否在Amazon产品页面（包含 `/dp/` 的URL）
- [ ] 浏览器控制台是否有错误
- [ ] 扩展是否已启用（chrome://extensions/）

---

## 📊 核心变更总结

### ✅ 已移除

- ❌ Puppeteer 自建爬虫
- ❌ Groq AI Provider
- ❌ Cookie收集逻辑
- ❌ 422个废弃依赖包

### ✅ 已添加

- ✅ CrawlerFacade 统一爬虫接口
- ✅ Outscraper主爬虫 + RapidAPI备用
- ✅ Gemini 2.5 Pro（唯一AI Provider）
- ✅ 完善的错误处理和降级策略

### 💰 成本对比

| 项目 | 之前 | 现在 | 节省 |
|------|------|------|------|
| 月度成本（1000份报告） | ¥372 | ¥52 | **¥320** |
| 服务器 | 需要 | 不需要 | ✅ |
| 维护成本 | 高 | 低 | ✅ |

---

## 🎉 下一步

一切正常后，您可以：

1. **开始使用** - 分析真实的Amazon产品
2. **查看文档** - 阅读 `docs/07-简化架构设计方案.md`
3. **部署上线** - 参考 `docs/05-腾讯云部署文档（宝塔面板）.md`
4. **反馈问题** - 如遇到任何问题，请反馈

---

**文档更新时间**: 2025-10-25  
**架构版本**: v2.0（简化版）



# 一键脚本使用说明

## 📦 已创建的脚本

| 脚本名称 | 功能说明 | 使用场景 |
|---------|---------|---------|
| **一键测试.bat** ⭐ | 完整自动化测试 | 首次使用、验证系统 |
| **快速启动.bat** | 快速启动服务 | 日常开发使用 |
| **启动Web前端.bat** | 单独启动Web | Web开发调试 |
| **停止所有服务.bat** | 停止所有服务 | 关闭所有Node进程 |

---

## 🚀 使用方法

### 方案一：完整测试（推荐首次使用）

**双击运行：`一键测试.bat`**

**功能：**
- ✅ 检查Node.js环境
- ✅ 检查并安装依赖
- ✅ 启动后端服务（如未运行）
- ✅ 验证架构简化完成度
- ✅ 测试API接口
- ✅ 检查配置文件状态
- ✅ 可选启动Web前端

**适用于：**
- 首次安装后验证
- 更新代码后测试
- 排查问题时诊断

---

### 方案二：快速启动（推荐日常使用）

**双击运行：`快速启动.bat`**

**功能：**
- 停止旧进程
- 启动后端服务
- 可选启动Web前端

**适用于：**
- 日常开发工作
- 快速启动系统
- 重启服务

---

### 方案三：停止所有服务

**双击运行：`停止所有服务.bat`**

**功能：**
- 强制停止所有Node.js进程

**适用于：**
- 下班关闭服务
- 服务卡死需要重启
- 释放端口占用

---

## 📝 详细功能说明

### 一键测试.bat

#### 测试流程

```
[1/6] 检查Node.js环境
      ├─ 检测Node.js是否安装
      └─ 显示Node.js版本

[2/6] 检查依赖包
      ├─ 检测node_modules目录
      └─ 自动运行npm install（如需要）

[3/6] 检查后端服务
      ├─ 测试 http://localhost:3001/api/health
      ├─ 如未运行则自动启动
      └─ 等待10秒后再次验证

[4/6] 运行架构验证
      ├─ 检查废弃文件是否删除
      ├─ 检查新文件是否创建
      └─ 验证简化架构完整性

[5/6] 测试API接口
      ├─ 健康检查接口
      └─ 任务创建接口

[6/6] 检查配置状态
      ├─ 检查.env文件
      ├─ 检查GEMINI_API_KEY
      └─ 检查OUTSCRAPER_API_KEY
```

#### 测试结果示例

```
✅ 架构简化：完成
   └─ 已移除 Puppeteer 和 Groq
   └─ 已创建 CrawlerFacade 统一接口
   └─ 已配置 Outscraper + Gemini

✅ 后端服务：正常运行
   └─ 地址: http://localhost:3001
   └─ 健康检查: 通过
```

---

## ⚙️ 配置API密钥

如果测试提示需要配置API密钥：

### 步骤1：复制配置文件

```bash
# 将 env.example 复制为 .env
copy env.example .env
```

### 步骤2：编辑 .env 文件

用记事本打开 `.env`，填写以下密钥：

```env
# 🤖 AI分析（必填）
GEMINI_API_KEY=your_real_gemini_api_key_here

# 🕷️ 爬虫服务（至少配置一个）
OUTSCRAPER_API_KEY=your_real_outscraper_api_key_here
RAPIDAPI_KEY=your_real_rapidapi_key_here
```

### 步骤3：获取API密钥

| 服务 | 获取地址 | 免费额度 |
|------|---------|---------|
| Gemini | https://aistudio.google.com/app/apikey | 免费 |
| Outscraper | https://outscraper.com/ | 500次/月 |
| RapidAPI | https://rapidapi.com/ | 500次/月 |

### 步骤4：重启服务

配置完成后，运行：`快速启动.bat`

---

## 🎯 常见场景

### 场景1：首次使用系统

```
1. 双击 "一键测试.bat"
2. 等待自动测试完成
3. 如提示需配置API密钥，按上述步骤配置
4. 配置完成后，再次运行 "一键测试.bat"
```

### 场景2：日常开发

```
1. 双击 "快速启动.bat"
2. 选择是否启动Web前端 (Y/N)
3. 开始开发工作
4. 完成后运行 "停止所有服务.bat"
```

### 场景3：只需要Web前端

```
1. 确保后端已运行（通过"快速启动.bat"）
2. 双击 "启动Web前端.bat"
3. 访问 http://localhost:3002
```

### 场景4：服务卡死

```
1. 双击 "停止所有服务.bat"
2. 双击 "快速启动.bat"
```

---

## 🔧 故障排查

### 问题1：提示"找不到Node.js"

**解决方案：**
1. 下载安装Node.js: https://nodejs.org/
2. 建议安装LTS版本（18.x或更高）
3. 安装完成后重启电脑
4. 再次运行脚本

### 问题2：端口被占用

**症状：** 服务启动失败，提示端口3001或3002被占用

**解决方案：**
```bash
# 方案A：停止所有Node进程
运行 "停止所有服务.bat"

# 方案B：查找并杀死占用端口的进程
netstat -ano | findstr :3001
taskkill /F /PID <PID号>
```

### 问题3：依赖安装失败

**解决方案：**
```bash
# 清理缓存后重新安装
npm cache clean --force
删除 node_modules 文件夹
删除 package-lock.json
npm install
```

### 问题4：API密钥配置错误

**检查清单：**
- [ ] .env文件是否存在（不是env.example）
- [ ] API密钥是否有引号（应该没有）
- [ ] API密钥前后是否有空格
- [ ] 密钥是否正确复制（完整无缺）

**正确格式：**
```env
GEMINI_API_KEY=AIzaSyAbc123def456ghi789...
```

**错误格式：**
```env
GEMINI_API_KEY="AIzaSy..."  ❌ 不要引号
GEMINI_API_KEY= AIzaSy...   ❌ 不要空格
GEMINI_API_KEY=your_key     ❌ 要填真实密钥
```

---

## 📊 测试输出说明

### 正常输出示例

```
[1/6] 检查Node.js环境...
   ✅ Node.js版本: v18.17.0

[2/6] 检查依赖包...
   ✅ 依赖包已安装

[3/6] 检查后端服务...
   ✅ 后端服务正常运行

[4/6] 运行架构验证测试...
   ✅ Groq Provider: 已删除
   ✅ Puppeteer爬虫: 已删除
   ✅ CrawlerFacade: 已创建
   ✅ Outscraper爬虫: 已创建
   ✅ 环境变量模板: 已创建

[5/6] 测试API接口...
   ✅ 健康检查正常
   ✅ 任务创建接口正常

[6/6] 检查配置状态...
   ✅ .env 配置文件存在
   ✅ Gemini API Key 已配置
   ✅ Outscraper API Key 已配置

🎉 测试完成！
```

### 异常输出说明

| 提示信息 | 含义 | 处理方式 |
|---------|------|---------|
| ❌ 未检测到Node.js | Node.js未安装 | 安装Node.js |
| ⚠️ 依赖包未安装 | 需要运行npm install | 脚本会自动处理 |
| ❌ 后端启动失败 | 端口被占用或依赖问题 | 运行"停止所有服务.bat" |
| ⚠️ API Key未配置 | .env文件未配置 | 按上述步骤配置 |

---

## 💡 高级用法

### 自定义测试端口

如果需要修改默认端口（3001、3002），编辑 `.env`：

```env
PORT=3001          # 后端端口
WEB_PORT=3002      # Web前端端口
```

### 调试模式

如需查看详细日志，修改 `.env`：

```env
LOG_LEVEL=debug    # 改为debug级别
DEBUG=true         # 启用调试模式
```

### 后台运行

如果想让服务在后台运行（关闭窗口不停止）：

```bash
# 修改 快速启动.bat
start /min "后端" cmd /c "npm start"
```

---

## 📚 相关文档

- [测试指南.md](测试指南.md) - 详细的手动测试步骤
- [README.md](README.md) - 项目完整说明
- [docs/07-简化架构设计方案.md](docs/07-简化架构设计方案.md) - 架构设计文档

---

**更新时间**: 2025-10-25  
**脚本版本**: v1.0


